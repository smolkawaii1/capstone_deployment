import O,{createContext as Bt}from"react";import{KBarProvider as Pt}from"kbar";export*from"kbar";import{useEffect as H,useState as rt,useContext as st}from"react";import{useNavigation as pt,useDelete as ct,useTranslate as lt,useResource as dt,useCanWithoutCache as mt,userFriendlyResourceName as ft,useRouterType as yt,useGo as bt}from"@refinedev/core";import{useRegisterActions as gt,createAction as x,KBarContext as xt,VisualState as ut}from"kbar";var b=n=>n.replace(/\w\S*/g,e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase());import{useGetToPath as ht}from"@refinedev/core";var S=()=>{let n=lt(),{resource:e,resources:s,id:p,action:f}=dt(),c=yt(),l=ht(),y=bt(),{mutate:Q}=ct(),{push:u,list:kt,create:Dt,show:zt,edit:Et}=pt(),X=st(xt),{can:a}=mt(),[K,Y]=rt([]);H(()=>{(async()=>await Promise.all(Z().flatMap(i=>_(i))))().then(i=>Y(i.flatMap(d=>d)))},[s,p,e,f]),H(()=>{K.length===0&&X.query.setVisualState(ut.hidden)},[K]);let Z=()=>{let t=[...s],i=t==null?void 0:t.findIndex(d=>{var w,h;return((w=d.identifier)!=null?w:d==null?void 0:d.name)===((h=e==null?void 0:e.identifier)!=null?h:e==null?void 0:e.name)});if(i>0){let d=t[i];t.splice(i,1),t.splice(0,0,d)}return t},_=async t=>{var E,L,M,N,W,$,q,G,U,V,j,F;let{name:i,label:d,list:w,create:h,canCreate:tt,canEdit:et,canShow:nt,icon:ot,show:D,canDelete:it,edit:z,route:Lt}=t,v=(N=(M=(E=t==null?void 0:t.meta)==null?void 0:E.label)!=null?M:(L=t==null?void 0:t.options)==null?void 0:L.label)!=null?N:d,R=(G=(q=(W=t==null?void 0:t.meta)==null?void 0:W.icon)!=null?q:($=t==null?void 0:t.options)==null?void 0:$.icon)!=null?G:ot,at=(F=(j=(U=t==null?void 0:t.meta)==null?void 0:U.canDelete)!=null?j:(V=t==null?void 0:t.options)==null?void 0:V.canDelete)!=null?F:it,A=v!=null?v:n(`${t.name}.${t.name}`,ft(t.name,"plural")),g=[];if(w&&(e!==void 0&&(e==null?void 0:e.name)!==i||f!==void 0&&(e==null?void 0:e.name)===i)){let{can:m}=await(a==null?void 0:a({resource:i,action:"show",params:{id:p,resource:t}}))||{can:!0};m&&g.push(x({name:n("actions.list",b("list")),section:A,icon:R,perform:()=>{let o=l({resource:t,action:"list",legacy:c==="legacy"});o&&(c==="legacy"?u(o):y({to:o}))}}))}if((tt||!!h)&&h&&(f!=="create"||(e==null?void 0:e.name)!==i)){let{can:m}=await(a==null?void 0:a({resource:i,action:"create",params:{resource:t}}))||{can:!0};m&&g.push(x({name:n("actions.create",b("create")),section:A,icon:R,keywords:"new",perform:()=>{let o=l({resource:t,action:"create",legacy:c==="legacy"});o&&(c==="legacy"?u(o):y({to:o}))}}))}if((e==null?void 0:e.name)===i&&p){if((nt||!!D)&&D&&f!=="show"){let{can:m}=await(a==null?void 0:a({resource:i,action:"show",params:{id:p,resource:t}}))||{can:!0};m&&g.push(x({name:n("actions.show",b("show")),section:A,icon:R,perform:()=>{let o=l({resource:t,action:"show",legacy:c==="legacy",meta:{id:p}});o&&(c==="legacy"?u(o):y({to:o}))}}))}if((et||!!z)&&z&&f!=="edit"){let{can:m}=await(a==null?void 0:a({resource:i,action:"show",params:{id:p,resource:t}}))||{can:!0};m&&g.push(x({name:n("actions.edit",b("edit")),section:A,icon:R,perform:()=>{let o=l({resource:t,action:"edit",legacy:c==="legacy",meta:{id:p}});o&&(c==="legacy"?u(o):y({to:o}))}}))}if(at){let{can:m}=await(a==null?void 0:a({resource:i,action:"show",params:{id:p,resource:t}}))||{can:!0};m&&g.push({id:"delete",name:n("actions.delete",b("delete")),section:A,icon:R},x({name:n("buttons.delete",b("delete")),section:n("buttons.confirm","Are you sure?"),parent:"delete",perform:()=>{Q({resource:t.name,id:p},{onSuccess:()=>{let o=l({resource:t,action:"list",legacy:c==="legacy"});o&&(c==="legacy"?u(o):y({to:o}))}})}}),x({name:n("buttons.cancel","Cancel"),parent:"delete",perform:()=>null}))}}return g};gt(K,[K])};import C from"react";import{KBarPortal as Rt,KBarPositioner as At,KBarAnimator as Ct,KBarSearch as Kt}from"kbar";var T=()=>C.createElement(Rt,null,C.createElement(At,{style:{opacity:1,transition:"background 0.35s cubic-bezier(0.4, 0, 0.2, 1) 0s",backdropFilter:"saturate(180%) blur(1px)",background:"rgba(0, 0, 0, 0.1)",zIndex:"9999"}},C.createElement(Ct,{style:{maxWidth:"600px",width:"100%",background:"white",color:"black",borderRadius:"8px",overflow:"hidden",boxShadow:"0px 4px 4px rgba(0, 0, 0, 0.25)"}},C.createElement(Kt,{style:{padding:"12px 16px",fontSize:"16px",width:"100%",boxSizing:"border-box",outline:"none",border:"none",background:"rgb(252 252 252)",color:"black"}}),C.createElement(B,null))));import P from"react";import{KBarResults as wt,useMatches as St}from"kbar";var It={padding:"8px 16px",fontSize:"14px",textTransform:"uppercase",fontWeight:"bold",opacity:.5},B=()=>{let{results:n,rootActionId:e}=St();return P.createElement(wt,{items:n,onRender:({item:s,active:p})=>typeof s=="string"?P.createElement("div",{style:It},s):P.createElement(I,{action:s,active:p,currentRootActionId:e})})};import r from"react";var I=r.forwardRef(({action:n,active:e,currentRootActionId:s},p)=>{var c;let f=r.useMemo(()=>{if(!s)return n.ancestors;let l=n.ancestors.findIndex(y=>y.id===s);return n.ancestors.slice(l+1)},[n.ancestors,s]);return r.createElement("div",{ref:p,style:{padding:"12px 16px",background:e?"rgba(0 0 0 / 0.05)":"transparent",borderLeft:`2px solid ${e?"rgb(28 28 29)":"transparent"}`,display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer"}},r.createElement("div",{style:{display:"flex",gap:"8px",alignItems:"center",fontSize:14}},n.icon&&n.icon,r.createElement("div",{style:{display:"flex",flexDirection:"column"}},r.createElement("div",null,f.length>0&&f.map(l=>r.createElement(r.Fragment,{key:l.id},r.createElement("span",{style:{opacity:.5,marginRight:8}},l.name),r.createElement("span",{style:{marginRight:8}},"\u203A"))),r.createElement("span",{style:{color:n.name.toLocaleUpperCase()==="DELETE"?"red":"black"}},n.name)),n.subtitle&&r.createElement("span",{style:{fontSize:12}},n.subtitle))),(c=n.shortcut)!=null&&c.length?r.createElement("div",{"aria-hidden":!0,style:{display:"grid",gridAutoFlow:"column",gap:"4px"}},n.shortcut.map(l=>r.createElement("kbd",{key:l,style:{padding:"4px 6px",background:"rgba(0 0 0 / .1)",borderRadius:"4px",fontSize:14}},l))):null)});I.displayName="ResultItem";import vt,{useContext as Tt}from"react";var J=({commandBarProps:n})=>{let e=Tt(k);S();let s={...e,...n};return vt.createElement(T,{...s})};var k=Bt({}),he=({children:n,commandBarProps:e})=>O.createElement(k.Provider,{value:e!=null?e:{}},O.createElement(Pt,null,n));export{J as RefineKbar,k as RefineKbarPropsContext,he as RefineKbarProvider,S as useRefineKbar};
//# sourceMappingURL=index.js.map